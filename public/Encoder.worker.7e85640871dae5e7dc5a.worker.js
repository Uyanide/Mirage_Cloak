/*! For license information please see Encoder.worker.7e85640871dae5e7dc5a.worker.js.LICENSE.txt */
(()=>{"use strict";var t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",ico:"image/x-icon",svg:"image/svg+xml",svgz:"image/svg+xml",bmp:"image/bmp",tiff:"image/tiff",tif:"image/tiff",wbmp:"image/vnd.wap.wbmp",avif:"image/avif",apng:"image/apng",jxl:"image/jxl",heic:"image/heic",heif:"image/heif",mp3:"audio/mpeg",ogg:"audio/ogg",wav:"audio/wav",weba:"audio/webm",mid:"audio/midi",midi:"audio/midi",oga:"audio/ogg",spx:"audio/ogg",opus:"audio/ogg",flac:"audio/flac",m4a:"audio/mp4",aac:"audio/aac",wma:"audio/x-ms-wma",mka:"audio/x-matroska",mp4:"video/mp4",webm:"video/webm",ogv:"video/ogg",avi:"video/x-msvideo",wmv:"video/x-ms-wmv",flv:"video/x-flv",mov:"video/quicktime",mkv:"video/x-matros","3gp":"video/3gpp","3g2":"video/3gpp2",m4v:"video/mp4",m4p:"video/mp4",m4b:"video/mp4",m4r:"video/mp4",f4v:"video/mp4",f4p:"video/mp4",f4a:"video/mp4",f4b:"video/mp4",txt:"text/plain",html:"text/html",htm:"text/html",css:"text/css",js:"text/javascript",md:"text/markdown",markdown:"text/markdown",csv:"text/csv",tsv:"text/tab-separated-values",ics:"text/calendar",vcf:"text/vcard",pdf:"application/pdf",doc:"application/msword",xls:"application/vnd.ms-excel",ppt:"application/vnd.ms-powerpoint",json:"application/json",xml:"application/xml",zip:"application/zip",rar:"application/x-rar-compressed","7z":"application/x-7z-compressed",tar:"application/x-tar",gz:"application/gzip",bz2:"application/x-bzip2",xz:"application/x-xz",exe:"application/x-msdownload"};function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function r(){r=function(){return i};var t,i={},n=Object.prototype,a=n.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},s="function"==typeof Symbol?Symbol:{},h=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function f(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{f({},"")}catch(t){f=function(t,e,r){return t[e]=r}}function u(t,e,r,i){var n=e&&e.prototype instanceof y?e:y,a=Object.create(n.prototype),s=new k(i||[]);return o(a,"_invoke",{value:M(t,r,s)}),a}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=u;var p="suspendedStart",g="suspendedYield",_="executing",m="completed",v={};function y(){}function b(){}function w(){}var x={};f(x,h,(function(){return this}));var S=Object.getPrototypeOf,B=S&&S(S(j([])));B&&B!==n&&a.call(B,h)&&(x=B);var A=w.prototype=y.prototype=Object.create(x);function L(t){["next","throw","return"].forEach((function(e){f(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,r){function i(n,o,s,h){var c=d(t[n],t,o);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==e(f)&&a.call(f,"__await")?r.resolve(f.__await).then((function(t){i("next",t,s,h)}),(function(t){i("throw",t,s,h)})):r.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return i("throw",t,s,h)}))}h(c.arg)}var n;o(this,"_invoke",{value:function(t,e){function a(){return new r((function(r,n){i(t,e,r,n)}))}return n=n?n.then(a,a):a()}})}function M(e,r,i){var n=p;return function(a,o){if(n===_)throw Error("Generator is already running");if(n===m){if("throw"===a)throw o;return{value:t,done:!0}}for(i.method=a,i.arg=o;;){var s=i.delegate;if(s){var h=P(s,i);if(h){if(h===v)continue;return h}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(n===p)throw n=m,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n=_;var c=d(e,r,i);if("normal"===c.type){if(n=i.done?m:g,c.arg===v)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n=m,i.method="throw",i.arg=c.arg)}}}function P(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator.return&&(r.method="return",r.arg=t,P(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var a=d(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,v;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function z(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function F(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(z,this),this.reset(!0)}function j(r){if(r||""===r){var i=r[h];if(i)return i.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var n=-1,o=function e(){for(;++n<r.length;)if(a.call(r,n))return e.value=r[n],e.done=!1,e;return e.value=t,e.done=!0,e};return o.next=o}}throw new TypeError(e(r)+" is not iterable")}return b.prototype=w,o(A,"constructor",{value:w,configurable:!0}),o(w,"constructor",{value:b,configurable:!0}),b.displayName=f(w,l,"GeneratorFunction"),i.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,w):(t.__proto__=w,f(t,l,"GeneratorFunction")),t.prototype=Object.create(A),t},i.awrap=function(t){return{__await:t}},L(E.prototype),f(E.prototype,c,(function(){return this})),i.AsyncIterator=E,i.async=function(t,e,r,n,a){void 0===a&&(a=Promise);var o=new E(u(t,e,r,n),a);return i.isGeneratorFunction(e)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},L(A),f(A,l,"Generator"),f(A,h,(function(){return this})),f(A,"toString",(function(){return"[object Generator]"})),i.keys=function(t){var e=Object(t),r=[];for(var i in e)r.push(i);return r.reverse(),function t(){for(;r.length;){var i=r.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},i.values=j,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(F),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function i(i,n){return s.type="throw",s.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var h=a.call(o,"catchLoc"),c=a.call(o,"finallyLoc");if(h&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(h){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var n=i;break}}n&&("break"===t||"continue"===t)&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var o=n?n.completion:{};return o.type=t,o.arg=e,n?(this.method="next",this.next=n.finallyLoc,v):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),F(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var i=r.completion;if("throw"===i.type){var n=i.arg;F(r)}return n}}throw Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:j(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),v}},i}function i(t,e,r,i,n,a,o){try{var s=t[a](o),h=s.value}catch(t){return void r(t)}s.done?e(h):Promise.resolve(h).then(i,n)}function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,h=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){h=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(h)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=Array(e);r<e;r++)i[r]=t[r];return i}function o(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,h(i.key),i)}}function s(t,e,r){return(e=h(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function h(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,r||"default");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}var c=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return e=t,a=null,s=[{key:"showTextOnMetaCanvas",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"暂不支持预览此文件",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.clearMetaCanvas(e);var n=e.querySelector("canvas"),a=n.getContext("2d");a.font="15px Microsoft Yahei",a.fillStyle=getComputedStyle(document.documentElement).getPropertyValue("--front-color"),a.textAlign="center",i?(a.fillText(r,n.width/2,n.height/2-10),a.fillText(i,n.width/2,n.height/2+10)):a.fillText(r,n.width/2,n.height/2)}},{key:"cloneImageData",value:function(t){var e=new ImageData(new Uint8ClampedArray(t.data),t.width,t.height);return console.log(e),console.log(e.data),console.log(t.data),e}},{key:"truncate",value:function(t){return Math.min(255,Math.max(0,t))}},{key:"adjustImageData",value:function(e,r,i,n){for(var a=new Uint8ClampedArray(r.data.length),o=r.data,s=259*(255+(i=5.1*(i-50)))/(255*(259-i)),h=3*n-150,c=0;c<a.length;c+=4)a[c]=t.truncate(s*(o[c]-128)+128+h),a[c+1]=t.truncate(s*(o[c+1]-128)+128+h),a[c+2]=t.truncate(s*(o[c+2]-128)+128+h),a[c+3]=255;var l=new ImageData(a,r.width,r.height);e.width=l.width,e.height=l.height,e.getContext("2d").putImageData(l,0,0)}},{key:"saveResultFromUrl",value:function(t,e){var r=(new Date).getTime(),i=document.createElement("a");i.href=t,i.download="decoded_".concat(r,".").concat(e),document.body.appendChild(i),i.click(),document.body.removeChild(i)}},{key:"clearMetaCanvas",value:function(e){e.querySelector(".sizeLabel").innerText="",e.querySelector(".typeLabel").innerText="";var r,i=n(e.querySelectorAll("canvas, video, audio"));try{for(i.s();!(r=i.n()).done;)r.value.classList.remove("displayFlex")}catch(t){i.e(t)}finally{i.f()}var a=e.querySelector("canvas");a.classList.add("displayFlex"),t.clearCanvas(a);var o,s=n(e.querySelectorAll("video, audio"));try{for(s.s();!(o=s.n()).done;){var h=o.value;h.src&&(h.pause(),h.currentTime=0,h.src="")}}catch(t){s.e(t)}finally{s.f()}}},{key:"getImageDataFromImageCanvas",value:function(t){var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var r=e.getContext("2d");return r.drawImage(t,0,0),r.getImageData(0,0,t.width,t.height)}},{key:"showMetaCanvas",value:(h=r().mark((function e(i,n,a,o){var s,h=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=h.length>4&&void 0!==h[4]?h[4]:1,e.abrupt("return",new Promise((function(e,r){var h=t.classifyFileType(a),c=[i.querySelector("canvas"),i.querySelector("video"),i.querySelector("audio")];switch(c.forEach((function(t){t.classList.remove("displayFlex")})),h.slice(0,5)){case"image":var l=new Image;l.onload=function(){c[0].width=l.width*s,c[0].height=l.height*s,c[0].getContext("2d").drawImage(l,0,0,l.width*s,l.height*s),c[0].classList.add("displayFlex"),e()},l.src=n;break;case"video":c[1].src=n,c[1].classList.add("displayFlex"),e();break;case"audio":c[2].src=n,c[2].classList.add("displayFlex"),e();break;default:t.showTextOnMetaCanvas(i,"暂不支持预览此文件","文件类型："+h),e()}t.showSize(i.querySelector(".sizeLabel"),o),i.querySelector(".typeLabel").innerText="里文件类型："+h})));case 2:case"end":return e.stop()}}),e)})),c=function(){var t=this,e=arguments;return new Promise((function(r,n){var a=h.apply(t,e);function o(t){i(a,r,n,o,s,"next",t)}function s(t){i(a,r,n,o,s,"throw",t)}o(void 0)}))},function(t,e,r,i){return c.apply(this,arguments)})},{key:"showSize",value:function(t,e){t.innerText="里文件大小："+function(t){return t>=1048576?(t/1048576).toFixed(2)+" MB":t>1024?(t/1024).toFixed(2)+" KB":t+" B"}(e)}}],a&&o(e.prototype,a),s&&o(e,s),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,a,s,h,c}();s(c,"classifyFileType",(function(e){return t[e]||"application/octet-stream"})),s(c,"clearCanvas",(function(t){t.width=300,t.height=150}));let l=[];self.onmessage=async t=>{try{switch(t.data.mission){case"init":l.push(new d(t.data.defaultArguments)),l.push(new f(t.data.defaultArguments)),l.push(new u(t.data.defaultArguments));break;case"length":postMessage({success:!0,result:l[t.data.version].getRequiredLength(t.data.hiddenFile,t.data.diff)});break;case"encode":postMessage({success:!0,result:l[t.data.version].encode(t.data.innerImageData,t.data.coverImageData,t.data.hiddenFile,t.data.fileExt,t.data.diff)})}}catch(t){postMessage({success:!1,error:t})}};class f{constructor(t){this._version=1,this._globalDefaultDiff=t.default_difference,this._defaultDiff=t.version_1.default_difference,this._remained=t.version_1.remained,this._padding=t.version_1.padding,this._scale_i=t.version_1.scale_inner,this._offset_i=t.version_1.offset_inner,this._scale_c=t.version_1.scale_cover,this._offset_c=t.version_1.offset_cover}encode(t,e,r,i,n,a=1){if(this._innerData=t.data,this._coverData=e.data,this._width=t.width,this._height=t.height,this._pixelRange=1===a?this._innerData.length>>2:3,1===a&&this._pixelRange<this.getRequiredLength(r))throw new Error("可用像素过少，编码空间不足！");this._version=a;let o=new Uint8ClampedArray(this._innerData.length);this._byteArray=r,this._targetSize=this._byteArray.length,this._fileExtension=i,this._diff=n||this._defaultDiff;for(let t=0;t<this._pixelRange;t++){const e=t<3?this._globalDefaultDiff:t<6?this._defaultDiff:this._diff;if(this._isInner(t)){const r=this._scale(this._innerData[4*t],this._scale_i,this._offset_i),{r:i,g:n,b:a}=this._getBits(t);o[4*t]=i?255-e:255,o[4*t+1]=n?255-e:255,o[4*t+2]=a?255-e:255,o[4*t+3]=r}else{const r=this._scale(this._coverData[4*t],this._scale_c,this._offset_c),{r:i,g:n,b:a}=this._getBits(t);o[4*t]=i?e:0,o[4*t+1]=n?e:0,o[4*t+2]=a?e:0,o[4*t+3]=255-r}}return o}getRequiredLength(t){return 3*(t.length+this._remained+this._padding)}_getBits=t=>{const e=t%3,r=Math.floor(t/3);return 0===r?this._getBitsFromByte(this._version,e):1===r?this._getBitsFromByte(Math.floor(this._diff/2),e):r<=5?this._getBitsFromByte(this._targetSize>>(r-2<<3)&255,e):r<this._remained?r-6<this._fileExtension.length?this._getBitsFromByte(this._fileExtension.charCodeAt(r-6),e):this._getBitsFromByte(0,e):r<this._targetSize+this._remained?this._getBitsFromByte(this._byteArray[r-this._remained],e):this._getRandomBits()};_scale=(t,e,r)=>Math.floor(t*e+r);_isInner=t=>(t%this._width+Math.floor(t/this._width))%2==0;_getBitsFromByte=(t,e)=>{const r=t>>3*e,i=1&r,n=r>>1&1;return 2!=e?{r:i,g:n,b:r>>2&1}:{r:i,g:n,b:this._calParityBit(t)}};_getRandomBits=()=>({r:Math.random()>.5?1:0,g:Math.random()>.5?1:0,b:Math.random()>.5?1:0});_calParityBit=t=>{let e=0;for(let r=0;r<8;r++)e^=t>>r&1;return e}}class u extends f{constructor(t){super(t),this._version=2,this._defaultDiff=t.version_2.default_difference,this._remained=t.version_2.remained,this._padding=t.version_2.padding,this._scale_i=t.version_2.scale_inner,this._offset_i=t.version_2.offset_inner,this._scale_c=t.version_2.scale_cover,this._offset_c=t.version_2.offset_cover}getRequiredLength(t){return 3*(t.length>>1+this._remained+this._padding)}encode(t,e,r,i,n){let a=super.encode(t,e,r,i,void 0,this._version);if(this._diff=n,this._pixelRange=t.data.length>>2,this._pixelRange<this.getRequiredLength(r))throw new Error("可用像素过少，编码空间不足！");if(1&this._targetSize){let t=new Uint8Array(this._targetSize+1);t.set(this._byteArray),t[this._targetSize]=0,this._byteArray=t}for(let t=3;t<this._pixelRange;t++){const e=Math.floor((t<6?this._defaultDiff:this._diff)/3);if(this._isInner(t)){const r=this._scale(this._innerData[4*t],this._scale_i,this._offset_i),{r:i,g:n,b:o}=this._getBitsPair(t);a[4*t]=255-e*i,a[4*t+1]=255-e*n,a[4*t+2]=255-e*o,a[4*t+3]=r}else{const r=this._scale(this._coverData[4*t],this._scale_c,this._offset_c),{r:i,g:n,b:o}=this._getBitsPair(t);a[4*t]=e*i,a[4*t+1]=e*n,a[4*t+2]=e*o,a[4*t+3]=255-r}}return a}_getBitsPair=t=>{const e=t%3,r=Math.floor(t/3);return r<2?this._getBitsFromBytePair(Math.floor(this._diff/6),e):r<4?this._getBitsFromBytePair(this._targetSize>>(r-2<<4)&65535,e):r<this._remained?r-4<this._fileExtension.length?this._getBitsFromBytePair(this._fileExtension.charCodeAt(r-4),e):this._getBitsFromByte(0,e):r<Math.ceil(this._targetSize/2)+this._remained?this._getBitsFromBytePair(this._byteArray[r-this._remained<<1]|this._byteArray[1+(r-this._remained<<1)]<<8,e):this._getRandomBits()};_getBitsFromBytePair=(t,e)=>{const r=t>>6*e,i=3&r,n=r>>2&3;return 2!=e?{r:i,g:n,b:r>>4&3}:{r:i,g:n,b:this._calParityBitPair(t)}};_calParityBitPair=t=>{let e=0;for(let r=0;r<8;r++)e^=t>>r&1;for(let r=8;r<16;r++)e^=(t>>r&1)<<1;return e};_getRandomBits=()=>({r:Math.floor(4*Math.random()),g:Math.floor(4*Math.random()),b:Math.floor(4*Math.random())})}class d{constructor(t){this._defaultDiff=t.version_0.default_difference,this._padding=t.version_0.padding,this._scale_i=t.version_0.scale_inner,this._offset_i=t.version_0.offset_inner,this._scale_c=t.version_0.scale_cover,this._offset_c=t.version_0.offset_cover}encode=(t,e,r,i,n)=>{const a=t.data,o=e.data,s=t.width,h=a.length>>2;this._targetSize=r.length,this._compress=this._calCompress(n||this._defaultDiff);let l=new Uint8ClampedArray(a.length);if(l[0]=248,l[1]=251,l[2]=248|this._compress,l[3]=this._scaleInner(a[0]),this._byteArray=[],this._byteArray.push(...this._targetSize.toString().split("").map((t=>t.charCodeAt(0)))),this._byteArray.push(1),this._byteArray.push(...("mtc."+i).split("").map((t=>t.charCodeAt(0)))),this._byteArray.push(1),this._byteArray.push(...c.classifyFileType(i).split("").map((t=>t.charCodeAt(0)))),this._byteArray.push(0),this._fileArray=r,this._byteArray.length>this._padding)throw new Error("头部信息过长！可尝试更改文件拓展名。");this._bytePos=0,this._buffer=0,this._bufferSize=0;const f=255&~((1<<this._compress)-1);for(let t=1;t<h;t++){const e=(t%s+Math.floor(t/s))%2==0;l[4*t]=e?f|this._popBits():this._popBits(),l[4*t+1]=e?f|this._popBits():this._popBits(),l[4*t+2]=e?f|this._popBits():this._popBits(),l[4*t+3]=e?this._scaleInner(a[4*t]):255-this._scaleCover(o[4*t])}if(this._bytePos<this._byteArray.length+this._targetSize)throw new Error("可用像素过少，编码空间不足！");return l};getRequiredLength=(t,e)=>{const r=this._calCompress(e);return Math.ceil((this._padding+t.length<<3)/r/3)+1};_calCompress=t=>Math.min(Math.max(Math.floor(t/10),1),7);_pushByte=()=>{const t=this._bytePos<this._byteArray.length?this._byteArray[this._bytePos]:this._bytePos<this._byteArray.length+this._targetSize?this._fileArray[this._bytePos-this._byteArray.length]:Math.floor(256*Math.random());this._bytePos++,this._buffer=this._buffer<<8|t,this._bufferSize+=8};_popBits=()=>{this._bufferSize<this._compress&&this._pushByte();const t=(this._buffer&(1<<this._compress)-1<<this._bufferSize-this._compress)>>this._bufferSize-this._compress;return this._bufferSize-=this._compress,this._buffer&=(1<<this._bufferSize)-1,t};_scaleInner=t=>Math.floor(t*this._scale_i+this._offset_i);_scaleCover=t=>Math.floor(t*this._scale_c+this._offset_c)}})();